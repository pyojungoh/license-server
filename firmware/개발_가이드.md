# ESP32 펌웨어 개발 가이드 (통합)

**통합일**: 2025-01-26

---

## 📋 목차

1. [테스트 가이드](#테스트-가이드)
2. [여러 ESP32 업로드](#여러-esp32-업로드)
3. [토큰 테스트](#토큰-테스트)

---

## 테스트 가이드

### 컴파일 테스트

1. **올바른 파일 열기**
   - ✅ `firmware/esp32_ble_hid/esp32_ble_hid.ino`
   - ❌ `esp32_ble_hid_backup.ino` (컴파일 안 됨)

2. **컴파일**
   - 스케치 → 검증/컴파일 (Ctrl+R)
   - "스케치가 컴파일되었습니다." 확인

### 업로드 테스트

1. **ESP32 연결 확인**
   - USB 케이블 연결
   - 장치 관리자에서 COM 포트 확인

2. **업로드**
   - 스케치 → 업로드 (Ctrl+U)
   - 정상 업로드 메시지 확인

3. **시리얼 모니터 확인**
   - 도구 → 시리얼 모니터 (Ctrl+Shift+M)
   - 보드레이트: 115200
   - 초기화 메시지 확인

**예상 출력**:
```
=================================
ESP32 BLE HID 키보드 시작
=================================
✓ 블루투스 키보드 초기화 완료
✓ 토큰 수신 서비스 시작됨
```

### 블루투스 연결 테스트

1. 모바일 기기의 블루투스 설정 열기
2. "한진택배 스캐너" 장치 검색
3. 페어링 성공 확인
4. 시리얼 모니터에 "블루투스 연결됨!" 메시지 확인

---

## 여러 ESP32 업로드

여러 개의 ESP32에 동일한 펌웨어를 업로드하는 방법:

### 순차 업로드 (권장)

1. **첫 번째 ESP32 연결**
   - USB 케이블로 PC에 연결
   - COM 포트 확인 (예: COM3)

2. **Arduino IDE 설정**
   - 도구 → 보드 → ESP32 Dev Module
   - 도구 → 포트 → COM3 선택

3. **업로드**
   - 스케치 → 업로드
   - 완료 대기

4. **다음 ESP32로 이동**
   - 첫 번째 ESP32 분리
   - 두 번째 ESP32 연결
   - 포트 변경 후 다시 업로드
   - 반복...

**참고**: 각 ESP32는 다른 COM 포트로 인식됩니다. 업로드할 때마다 포트를 변경해야 합니다.

---

## 토큰 테스트

### 현재 상태 확인

시리얼 모니터에 다음이 표시되면 정상:
```
✓ 블루투스 연결됨!
⏳ 인증 토큰 대기 중... (앱에서 토큰을 전송하세요)
```

### 토큰 수신 확인

1. 모바일 앱에서 ESP32로 토큰 전송
2. 시리얼 모니터에 다음 메시지 확인:
   ```
   → 토큰 수신: [토큰 내용]
   ✓ 인증 성공! 키보드 기능 활성화됨
   ```

### 키보드 기능 테스트

1. PC 프로그램에서 송장번호 전송
2. 모바일 앱에서 입력 확인
3. Tab 2회 + Enter + Shift+Tab 2회 동작 확인

---

## 문제 해결

자세한 내용은 `docs/개발자/ESP32_가이드.md` 참조

