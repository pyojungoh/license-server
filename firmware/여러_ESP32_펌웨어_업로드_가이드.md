# 여러 ESP32 펌웨어 업로드 가이드

## 📌 개요

여러 개의 ESP32 칩을 구매하셨다면, 각 ESP32에 동일한 펌웨어를 업로드하면 됩니다. 모든 ESP32가 동일하게 동작하며, PC 프로그램에서 각 ESP32를 COM 포트로 구분하여 사용할 수 있습니다.

## 🔧 준비사항

### 하드웨어
- [ ] ESP32 칩 여러 개
- [ ] USB 케이블 (ESP32 개수만큼, 또는 1개씩 순차 업로드)
- [ ] PC (Windows)

### 소프트웨어
- [ ] Arduino IDE 설치 완료
- [ ] ESP32 보드 패키지 설치 완료
- [ ] ESP32-BLE-Keyboard 라이브러리 설치 완료

## 📤 펌웨어 업로드 절차

### 방법 1: 순차 업로드 (권장)

**하나의 USB 케이블로 여러 ESP32를 하나씩 업로드하는 방법**

1. **첫 번째 ESP32 연결**
   - USB 케이블로 PC에 연결
   - Windows 장치 관리자에서 COM 포트 확인 (예: COM3)
   
2. **Arduino IDE 설정**
   - **도구 → 보드 → ESP32 Arduino → ESP32 Dev Module** 선택
   - **도구 → 포트 → COM3** (연결된 포트) 선택
   - **도구 → 업로드 속도 → 115200** 선택
   
3. **펌웨어 파일 열기**
   - `firmware/esp32_ble_hid/esp32_ble_hid.ino` 파일 열기
   
4. **업로드**
   - **스케치 → 업로드** (Ctrl+U) 클릭
   - 업로드 완료까지 대기 (약 30초~1분)
   
5. **시리얼 모니터 확인**
   - **도구 → 시리얼 모니터** (Ctrl+Shift+M) 열기
   - 보드레이트: **115200** 설정
   - 다음 메시지 확인:
     ```
     =================================
     ESP32 BLE HID 키보드 시작
     =================================
     ✓ 블루투스 키보드 초기화 완료
     ✓ 토큰 수신 서비스 시작됨
     ```

6. **다음 ESP32 연결**
   - 현재 ESP32의 USB 케이블 분리
   - 두 번째 ESP32 연결
   - 장치 관리자에서 새로운 COM 포트 확인 (예: COM4)
   - Arduino IDE에서 **도구 → 포트 → COM4** 선택
   - **4~5단계 반복**

7. **나머지 ESP32에도 반복**
   - 3번째, 4번째... 모든 ESP32에 동일하게 적용

### 방법 2: USB 허브 사용 (고급)

여러 개의 USB 포트가 있는 허브를 사용하면 여러 ESP32를 동시에 연결할 수 있습니다.

**주의사항:**
- 각 ESP32는 서로 다른 COM 포트에 연결됩니다
- 업로드할 때 정확한 포트를 선택해야 합니다
- 동시에 여러 개를 업로드할 수 없으므로, 여전히 하나씩 업로드해야 합니다

## ✅ 업로드 확인 체크리스트

각 ESP32 업로드 후 다음을 확인하세요:

- [ ] 업로드 성공 메시지 확인
- [ ] 시리얼 모니터에서 초기화 메시지 확인
- [ ] 모바일 블루투스 설정에서 "한진택배 스캐너" 장치 검색 가능
- [ ] LED가 정상 작동 (연결 시 켜짐)

## 📱 모바일 앱에서 사용 방법

### 여러 ESP32 구분하기

**현재 시스템:**
- 모든 ESP32는 동일한 BLE 장치 이름을 사용합니다: **"한진택배 스캐너"**
- 모바일 앱은 가장 먼저 발견되는 "한진택배 스캐너"에 연결합니다
- 각 PC는 하나의 ESP32만 사용하므로 문제가 없습니다

**사용 시나리오:**
- PC 1개 = ESP32 1개 = 모바일 앱 1개
- 각 PC마다 독립적으로 작동합니다
- 서로 간섭하지 않습니다

## 🔍 ESP32 식별 방법

### PC 프로그램에서

PC 프로그램(`gui_app.py`)에서는 **COM 포트**로 각 ESP32를 구분합니다:

1. **COM 포트 확인**
   - Windows 장치 관리자 → 포트(COM & LPT)
   - 각 ESP32는 고유한 COM 포트 번호를 가집니다
   - 예: COM3, COM4, COM5...

2. **프로그램에서 포트 선택**
   - 프로그램 실행 후 COM 포트 드롭다운에서 해당 ESP32의 포트 선택
   - 예: 첫 번째 ESP32 = COM3, 두 번째 ESP32 = COM4

### ESP32에 라벨 부착 (권장)

물리적으로 구분하기 위해:
- 각 ESP32에 라벨지나 테이프로 번호 표시
- 예: "ESP32 #1", "ESP32 #2", "ESP32 #3"
- USB 케이블에도 같은 번호 표시

## ⚙️ 고급: ESP32별로 장치 이름 변경 (선택사항)

만약 여러 ESP32를 물리적으로 구분하고 싶다면, 펌웨어에서 장치 이름을 변경할 수 있습니다:

### 예시: ESP32 #1
```cpp
BleKeyboard bleKeyboard("한진택배 스캐너 #1", "Hanjin Automation", 100);
```

### 예시: ESP32 #2
```cpp
BleKeyboard bleKeyboard("한진택배 스캐너 #2", "Hanjin Automation", 100);
```

**주의:**
- 장치 이름을 변경하면 모바일 앱의 장치 검색 로직도 확인이 필요할 수 있습니다
- 현재는 "한진택배 스캐너"로 고정 검색하므로, 모든 ESP32를 동일한 이름으로 사용하는 것을 권장합니다

## 🚀 빠른 업로드 팁

### 배치 업로드 순서

1. **ESP32를 일렬로 배치**
   - 라벨로 번호 표시
   
2. **업로드 순서대로 진행**
   - ESP32 #1 → COM3 → 업로드
   - ESP32 #2 → COM4 → 업로드
   - ESP32 #3 → COM5 → 업로드
   - ...

3. **각 업로드 후 확인**
   - 시리얼 모니터로 정상 작동 확인
   - 다음 ESP32로 이동

### 업로드 속도 향상

- **Arduino IDE를 여러 개 열지 마세요**
  - 하나의 Arduino IDE로 순차 업로드하는 것이 안전합니다
  
- **업로드 전 체크리스트**
  - 올바른 보드 선택 확인
  - 올바른 포트 선택 확인
  - 시리얼 모니터 닫기 (업로드 시)

## 🐛 문제 해결

### 문제: 업로드가 실패합니다

**해결:**
1. 다른 USB 케이블 사용
2. 다른 USB 포트 사용
3. ESP32의 BOOT 버튼을 누른 상태에서 업로드 시작
4. Arduino IDE 재시작

### 문제: COM 포트가 인식되지 않습니다

**해결:**
1. USB 케이블 재연결
2. CH340 드라이버 재설치 (필요시)
3. Windows 장치 관리자에서 포트 상태 확인

### 문제: 여러 ESP32를 연결했는데 하나만 인식됩니다

**해결:**
- 이는 정상입니다
- 한 번에 하나의 ESP32에만 업로드해야 합니다
- 업로드 후 USB 케이블을 분리하고 다음 ESP32를 연결하세요

## 📋 요약

1. ✅ 모든 ESP32에 **동일한 펌웨어** 업로드
2. ✅ 각 ESP32는 **COM 포트로 구분**
3. ✅ PC 프로그램에서 **포트 선택**하여 사용
4. ✅ 물리적으로 **라벨 부착**으로 구분 (권장)
5. ✅ 모바일 앱은 각 PC 환경에서 **독립적으로 작동**

## 🎯 다음 단계

1. 모든 ESP32에 펌웨어 업로드 완료
2. 각 ESP32 테스트 (시리얼 모니터 확인)
3. PC 프로그램에서 각 ESP32 포트 선택하여 사용
4. 모바일 앱에서 연결 테스트

---

**질문이나 문제가 있으면 알려주세요!**

