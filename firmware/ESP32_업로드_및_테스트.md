# ESP32 펌웨어 업로드 및 테스트 가이드

## ✅ 1단계: 컴파일 완료
- 컴파일 성공 확인 완료!

## 📤 2단계: ESP32에 업로드

### 준비사항
- [ ] ESP32가 USB 포트에 연결되어 있음
- [ ] Arduino IDE에서 포트 선택 확인 (도구 → 포트 → COMx)

### 업로드 방법
1. **스케치 → 업로드** (Ctrl+U) 클릭
2. 하단 출력 창에서 업로드 진행 상황 확인

**정상적인 업로드 과정:**
```
Connecting........_____
Writing at 0x00010000... (100%)
Leaving...
Hard resetting via RTS pin...
```

### 업로드 오류 해결

#### 오류: "Failed to connect to ESP32"
**해결 방법:**
1. ESP32의 **BOOT 버튼**을 누른 상태에서 업로드 시작
2. "Connecting..." 메시지가 나오면 BOOT 버튼 떼기
3. 또는 USB 케이블을 뽑았다가 다시 연결

#### 오류: "Serial port 'COMx' already in use"
**해결 방법:**
1. Arduino IDE의 **시리얼 모니터 닫기**
2. 다른 시리얼 통신 프로그램 종료
3. 다시 업로드 시도

## 📊 3단계: 시리얼 모니터 확인

### 시리얼 모니터 열기
1. **도구 → 시리얼 모니터** (Ctrl+Shift+M)
2. 오른쪽 하단 **보드레이트: 115200** 설정

### 예상 출력 메시지

업로드 성공 후 다음 메시지가 보여야 합니다:

```
=================================
ESP32 BLE HID 키보드 시작
=================================
✓ 블루투스 키보드 초기화 완료
✓ 토큰 수신 서비스 시작됨
  Service UUID: 12345678-1234-1234-1234-123456789ABC
  Characteristic UUID: 12345678-1234-1234-1234-123456789DEF

=================================
모바일 기기에서 '한진택배 스캐너'를 찾아 페어링하세요.
앱에서 인증 토큰을 전송하면 키보드 기능이 활성화됩니다.
=================================
```

### 메시지가 안 보이면
1. ESP32 재부팅 (EN 버튼 누르거나 USB 재연결)
2. 시리얼 모니터 보드레이트 확인 (115200)
3. 시리얼 모니터 닫았다가 다시 열기

## 🔵 4단계: 블루투스 연결 테스트

### 모바일 기기에서 연결
1. 모바일의 **블루투스 설정** 열기
2. 블루투스 장치 검색
3. **"한진택배 스캐너"** 장치 찾기
4. 페어링 요청 시 **"페어링"** 또는 **"연결"** 선택

### 연결 확인
- 시리얼 모니터에 다음 메시지 표시:
  ```
  ✓ 블루투스 연결됨!
  ```

### 연결이 안 되면
1. ESP32 재부팅 (USB 재연결)
2. 모바일 블루투스 끄기/켜기
3. 모바일 재부팅
4. 다시 페어링 시도

## 🔐 5단계: 토큰 수신 테스트 준비

### 현재 상태
- ESP32는 토큰 수신 서비스가 활성화되어 있음
- 모바일 앱이 개발되면 토큰을 전송할 수 있음

### 토큰 수신 확인 방법 (모바일 앱 개발 후)
1. 모바일 앱에서 ESP32로 토큰 전송
2. 시리얼 모니터에 다음 메시지 표시:
   ```
   → 토큰 수신: [토큰 내용]
   ✓ 인증 성공! 키보드 기능 활성화됨
   ```

### 인증 성공 확인
- LED가 켜짐 (GPIO2)
- 시리얼 모니터에 "인증 성공" 메시지 표시
- 이후 PC에서 시리얼로 텍스트를 보내면 키보드로 입력됨

## 📋 테스트 체크리스트

### 업로드 단계
- [ ] 컴파일 성공 확인
- [ ] ESP32 USB 연결 확인
- [ ] 포트 선택 확인 (COMx)
- [ ] 업로드 성공 확인
- [ ] 시리얼 모니터에서 초기화 메시지 확인

### 블루투스 연결 단계
- [ ] 모바일에서 "한진택배 스캐너" 장치 발견
- [ ] 블루투스 페어링 성공
- [ ] 시리얼 모니터에 "블루투스 연결됨" 메시지 확인

### 토큰 수신 단계 (모바일 앱 개발 후)
- [ ] 모바일 앱에서 토큰 전송
- [ ] 시리얼 모니터에 "토큰 수신" 메시지 확인
- [ ] "인증 성공" 메시지 확인
- [ ] LED가 켜짐 확인

### 키보드 기능 테스트 (모바일 앱 개발 후)
- [ ] PC에서 시리얼 통신으로 텍스트 전송 테스트
- [ ] 모바일 앱에서 입력 확인
- [ ] Tab 2회 + Enter + Shift+Tab 2회 동작 확인

## 🎯 다음 단계

1. **펌웨어 업로드** (현재 단계)
2. **블루투스 연결 테스트**
3. **모바일 앱 개발** (다음 작업)
   - 서버 로그인
   - 토큰 발급
   - ESP32로 토큰 전송

## ⚠️ 주의사항

1. **인증 없이는 키보드 작동 안 됨**
   - 모바일 앱에서 토큰을 보내기 전까지는 키보드 입력이 동작하지 않습니다
   - 이는 의도된 동작입니다 (보안 기능)

2. **BLE 서비스 UUID**
   - Service UUID: `12345678-1234-1234-1234-123456789ABC`
   - Characteristic UUID: `12345678-1234-1234-1234-123456789DEF`
   - 모바일 앱 개발 시 이 UUID를 사용해야 합니다

3. **시리얼 모니터와 업로드 충돌**
   - 업로드할 때는 시리얼 모니터를 닫아야 합니다
   - 업로드 후 다시 시리얼 모니터를 열어야 합니다

## 🆘 문제 해결

### 시리얼 모니터에 아무것도 안 나옴
1. ESP32 재부팅 (USB 재연결)
2. 시리얼 모니터 보드레이트 확인 (115200)
3. 다른 USB 케이블 사용

### 블루투스 연결이 안 됨
1. ESP32 재부팅
2. 모바일 블루투스 재시작
3. 모바일에서 이전 연결 정보 삭제 후 다시 시도

### 업로드가 계속 실패
1. 다른 USB 포트 사용
2. 다른 USB 케이블 사용
3. ESP32 보드의 BOOT 버튼을 누른 상태에서 업로드 시작

## ✅ 성공 기준

다음이 모두 확인되면 성공:
- ✅ 컴파일 성공
- ✅ 업로드 성공
- ✅ 시리얼 모니터에 초기화 메시지 출력
- ✅ 토큰 수신 서비스 시작 메시지 출력
- ✅ 모바일에서 "한진택배 스캐너" 블루투스 장치 검색 가능






