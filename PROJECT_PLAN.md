# 한진택배 송장번호 자동 등록 시스템 - 상세 구현 계획

## 📌 프로젝트 배경

### 문제점
- 한진택배 모바일 앱에서 송장번호를 수동으로 입력해야 하는 비효율
- 대량의 송장번호를 일일이 타이핑하는 반복 작업
- 앱 업데이트 시 좌표 기반 자동화의 취약성

### 해결 방안
- **블루투스 HID 키보드 에뮬레이션** 방식 채택
- ESP32를 BLE HID 키보드로 동작시켜 실제 스캐너처럼 동작
- 앱 업데이트에 영향받지 않는 안정적인 솔루션

## 🎯 최종 목표

1. 엑셀 파일에서 송장번호 읽기
2. ESP32를 통해 블루투스 키보드 입력으로 모바일 앱에 자동 입력
3. 대량 처리 (수백 건) 자동화
4. 진행 상황 추적 및 로깅

## 🔄 기술 선택 이유

### 선택: ESP32 + BLE HID (방법 B)

#### 장점
- ✅ 앱 업데이트에 영향받지 않음
- ✅ 실제 스캐너와 동일한 방식으로 동작
- ✅ 좌표 설정 불필요
- ✅ 안정적이고 유지보수 용이
- ✅ 가격 저렴 (약 8,000원)

#### 대안 비교
- ❌ 방법 A (좌표 기반): 앱 업데이트 시 재설정 필요
- ❌ 방법 C (소프트웨어 BLE): Windows에서 구현 복잡, 드라이버 이슈

## 📋 구현 단계별 상세 계획

### Phase 1: 하드웨어 준비 및 펌웨어 개발

#### 1.1 하드웨어 확인
- [x] ESP32 개발 보드 구매 완료
- [ ] 제품 수령 및 외관 확인
- [ ] USB-C 케이블 준비
- [ ] PC USB 포트 연결 테스트

#### 1.2 개발 환경 설정
- [ ] Arduino IDE 설치
- [ ] ESP32 보드 패키지 추가
- [ ] 필요한 라이브러리 설치
  - `ESP32 BLE Keyboard` 라이브러리
- [ ] COM 포트 확인 및 설정

#### 1.3 펌웨어 개발
**파일**: `firmware/esp32_ble_hid.ino`

**기능 요구사항**:
1. BLE HID 키보드 프로파일 구현
2. 시리얼 통신으로 텍스트 수신
3. 수신한 텍스트를 키보드 입력으로 변환
4. 엔터 키 자동 전송 (스캐너처럼)
5. 연결 상태 LED 표시 (선택)

**구현 내용**:
```cpp
// 주요 기능
- BLE HID 키보드 초기화
- 시리얼 통신 설정 (115200 baud)
- 텍스트 수신 → HID 키 입력 변환
- 에러 처리 및 재연결 로직
```

#### 1.4 펌웨어 테스트
- [ ] 펌웨어 업로드 성공 확인
- [ ] 시리얼 모니터로 통신 테스트
- [ ] 모바일과 블루투스 페어링 테스트
- [ ] 키보드 입력 테스트 (메모장 등)

### Phase 2: Python 제어 프로그램 개발

#### 2.1 프로젝트 구조 생성
- [ ] 디렉토리 구조 생성
- [ ] `requirements.txt` 작성
- [ ] `config/settings.json` 템플릿 생성

#### 2.2 시리얼 통신 모듈
**파일**: `src/bluetooth_controller.py`

**기능**:
- ESP32와 시리얼 통신 연결
- 송장번호 텍스트 전송
- 연결 상태 확인
- 에러 처리 및 재연결

**API 설계**:
```python
class BluetoothController:
    def __init__(self, port, baudrate=115200)
    def connect()
    def disconnect()
    def send_text(text: str)
    def is_connected() -> bool
```

#### 2.3 엑셀 읽기 모듈
**파일**: `src/excel_reader.py`

**기능**:
- 엑셀 파일 읽기
- 송장번호 컬럼 추출
- 문자열로 처리 (앞자리 0 보존)
- 데이터 검증

**API 설계**:
```python
class ExcelReader:
    def __init__(self, file_path, column_name, sheet_name)
    def read_invoices() -> List[str]
    def validate_data() -> bool
```

#### 2.4 메인 자동화 로직
**파일**: `src/main.py`

**기능**:
- 설정 파일 로드
- 엑셀 데이터 읽기
- 자동화 워크플로우 실행
- 진행 상황 표시
- 로깅

**워크플로우**:
```
1. 설정 로드
2. ESP32 연결
3. 엑셀 파일 읽기
4. 각 송장번호에 대해:
   a. ESP32로 텍스트 전송
   b. 딜레이 (랜덤)
   c. 진행 상황 업데이트
   d. 로그 기록
5. 완료 메시지
6. 연결 종료
```

#### 2.5 유틸리티 모듈
**파일**: `src/utils.py`

**기능**:
- 로깅 설정
- 딜레이 함수 (랜덤)
- 진행률 표시
- 에러 처리 헬퍼

### Phase 3: 통합 및 테스트

#### 3.1 단위 테스트
- [ ] 시리얼 통신 모듈 테스트
- [ ] 엑셀 읽기 모듈 테스트
- [ ] 유틸리티 함수 테스트

#### 3.2 통합 테스트
- [ ] PC ↔ ESP32 통신 테스트
- [ ] ESP32 ↔ 모바일 블루투스 테스트
- [ ] 전체 워크플로우 테스트 (소량 데이터)

#### 3.3 성능 테스트
- [ ] 대량 데이터 처리 테스트 (100건)
- [ ] 딜레이 최적화
- [ ] 메모리 사용량 확인

#### 3.4 에러 처리 테스트
- [ ] 시리얼 통신 끊김 시나리오
- [ ] 블루투스 연결 끊김 시나리오
- [ ] 잘못된 엑셀 데이터 처리

### Phase 4: 최적화 및 문서화

#### 4.1 성능 최적화
- [ ] 딜레이 값 튜닝
- [ ] 재시도 로직 개선
- [ ] 메모리 최적화

#### 4.2 사용자 경험 개선
- [ ] 진행률 표시 개선
- [ ] 색상 출력 추가
- [ ] 에러 메시지 개선

#### 4.3 문서화
- [ ] 사용자 가이드 작성
- [ ] 트러블슈팅 가이드
- [ ] 코드 주석 보완

## 🔧 기술 스택 상세

### 하드웨어
- **ESP32-WROOM-32**
  - CPU: Xtensa 듀얼코어 32비트
  - 무선: WiFi + Bluetooth 4.2 (BLE)
  - USB: USB-C (CH340)

### 펌웨어
- **Arduino IDE**
- **ESP32 Arduino Core**
- **ESP32 BLE Keyboard Library**

### 소프트웨어
- **Python 3.8+**
- **pyserial**: 시리얼 통신
- **openpyxl**: 엑셀 파일 읽기
- **colorama**: 터미널 색상 (선택)

## 📊 예상 일정

| 단계 | 작업 | 예상 시간 |
|------|------|----------|
| Phase 1 | 하드웨어 준비 및 펌웨어 | 2-3시간 |
| Phase 2 | Python 프로그램 개발 | 3-4시간 |
| Phase 3 | 통합 및 테스트 | 2-3시간 |
| Phase 4 | 최적화 및 문서화 | 1-2시간 |
| **총계** | | **8-12시간** |

## ⚠️ 주의사항

1. **송장번호 형식**
   - 반드시 문자열로 처리하여 앞자리 0 보존
   - 엑셀에서 숫자 형식으로 저장되면 0이 사라질 수 있음

2. **딜레이 설정**
   - 너무 빠르면 앱이 튕기거나 서버 차단 가능
   - 적절한 딜레이 필수 (건당 2-3초)

3. **블루투스 연결**
   - 모바일 앱이 입력 대기 상태여야 함
   - 연결 끊김 시 재연결 로직 필요

4. **에러 처리**
   - 실패한 항목은 별도 파일로 저장
   - 재실행 시 실패한 항목만 처리 가능하도록

## 🎯 성공 기준

- [ ] 100건의 송장번호를 자동으로 입력 가능
- [ ] 에러율 5% 미만
- [ ] 앱 업데이트 후에도 정상 동작
- [ ] 사용자가 쉽게 실행 가능

## 📝 다음 작업 (제품 도착 후 즉시 시작)

1. **하드웨어 확인 및 연결**
   - ESP32 USB 연결
   - COM 포트 확인
   - 드라이버 설치 확인

2. **Arduino IDE 설정**
   - ESP32 보드 패키지 설치
   - 라이브러리 설치

3. **펌웨어 개발 시작**
   - 기본 BLE HID 키보드 코드 작성
   - 시리얼 통신 추가

---

**작성일**: 2024-12-24  
**최종 수정**: 2024-12-24











