<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>í•œì§„íƒë°° ëŒ€ëŸ‰ ì§‘í•˜ ì²˜ë¦¬ í…ŒìŠ¤íŠ¸</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'ë§‘ì€ ê³ ë”•', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background-color: #f5f5f5;
            padding: 20px;
            max-width: 600px;
            margin: 0 auto;
        }

        .container {
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            padding: 20px;
        }

        .header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid #e0e0e0;
        }

        .header-title {
            font-size: 20px;
            font-weight: bold;
            color: #333;
        }

        .header-icons {
            display: flex;
            gap: 15px;
        }

        .icon {
            font-size: 20px;
            color: #666;
            cursor: pointer;
        }

        .instruction {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 20px;
            padding: 10px;
            background-color: #f0f0f0;
            border-radius: 5px;
            font-size: 14px;
            color: #666;
        }

        .sync-icon {
            font-size: 18px;
            cursor: pointer;
        }

        .input-section {
            margin-bottom: 20px;
        }

        .input-label {
            font-size: 14px;
            font-weight: bold;
            color: #333;
            margin-bottom: 8px;
            display: block;
        }

        .input-container {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .waybill-input {
            flex: 1;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 5px;
            font-size: 16px;
        }

        .waybill-input:focus {
            outline: none;
            border-color: #007bff;
        }

        .camera-icon {
            font-size: 20px;
            color: #666;
            cursor: pointer;
        }

        .enter-button {
            padding: 12px 30px;
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 5px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
        }

        .enter-button:hover {
            background-color: #0056b3;
        }

        .enter-button:focus {
            outline: 2px solid #0056b3;
        }

        .counters {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            padding: 10px;
            background-color: #f9f9f9;
            border-radius: 5px;
            font-size: 14px;
            flex-wrap: wrap;
        }

        .counter-item {
            color: #666;
        }

        .counter-item .total {
            font-weight: bold;
            color: #333;
        }

        .box-type-section {
            margin-bottom: 20px;
        }

        .box-type-container {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .box-type-select {
            padding: 10px;
            border: 2px solid #ddd;
            border-radius: 5px;
            font-size: 16px;
            background-color: white;
        }

        .box-buttons {
            display: flex;
            gap: 5px;
        }

        .box-button {
            padding: 10px 20px;
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 5px;
            font-size: 14px;
            cursor: pointer;
        }

        .box-button:hover {
            background-color: #0056b3;
        }

        .duplicate-info {
            display: flex;
            align-items: center;
            gap: 5px;
            margin-top: 10px;
            font-size: 14px;
            color: #666;
        }

        .list-header {
            display: grid;
            grid-template-columns: 40px 1fr 80px 80px;
            gap: 10px;
            padding: 10px;
            background-color: #f0f0f0;
            border-radius: 5px 5px 0 0;
            font-weight: bold;
            font-size: 14px;
            color: #666;
            border-bottom: 2px solid #ddd;
        }

        .list-item {
            display: grid;
            grid-template-columns: 40px 1fr 80px 80px;
            gap: 10px;
            padding: 12px 10px;
            border-bottom: 1px solid #e0e0e0;
            align-items: center;
        }

        .list-item:hover {
            background-color: #f9f9f9;
        }

        .list-item:last-child {
            border-bottom: none;
        }

        .checkbox {
            width: 20px;
            height: 20px;
            cursor: pointer;
        }

        .waybill-number {
            font-size: 14px;
            color: #333;
        }

        .select-button, .delete-button {
            padding: 6px 12px;
            border: none;
            border-radius: 4px;
            font-size: 12px;
            cursor: pointer;
        }

        .select-button {
            background-color: #28a745;
            color: white;
        }

        .delete-button {
            background-color: #dc3545;
            color: white;
        }

        .empty-message {
            padding: 40px;
            text-align: center;
            color: #999;
            font-size: 14px;
        }

        .reset-button {
            width: 100%;
            padding: 15px;
            margin-top: 20px;
            background-color: #6c757d;
            color: white;
            border: none;
            border-radius: 5px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
        }

        .reset-button:hover {
            background-color: #5a6268;
        }

        .log-section {
            margin-top: 20px;
            padding: 15px;
            background-color: #f9f9f9;
            border-radius: 5px;
            max-height: 200px;
            overflow-y: auto;
        }

        .log-title {
            font-weight: bold;
            margin-bottom: 10px;
            color: #333;
        }

        .log-entry {
            font-size: 12px;
            color: #666;
            margin-bottom: 5px;
            font-family: monospace;
        }

        .log-entry.success {
            color: #28a745;
        }

        .log-entry.error {
            color: #dc3545;
        }

        .log-entry.info {
            color: #007bff;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="header-title">ëŒ€ëŸ‰ ì§‘í•˜ ì²˜ë¦¬</div>
            <div class="header-icons">
                <span class="icon">ğŸ“„</span>
                <span class="icon">ğŸ””</span>
                <span class="icon">â˜°</span>
            </div>
        </div>

        <div class="instruction">
            <span>ëŒ€ëŸ‰ê±´ ëˆ„ë½ ë°œìƒì‹œ ë™ê¸°í™” ë²„íŠ¼ í´ë¦­</span>
            <span class="sync-icon">ğŸ”„</span>
        </div>

        <div class="input-section">
            <label class="input-label">ìš´ì†¡ì¥ ë²ˆí˜¸</label>
            <div class="input-container">
                <input type="text" 
                       id="waybillInput" 
                       class="waybill-input" 
                       placeholder="ìš´ì†¡ì¥ ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”."
                       autocomplete="off">
                <span class="camera-icon">ğŸ“·</span>
                <button class="enter-button" id="enterButton">ì…ë ¥</button>
            </div>
        </div>

        <div class="counters">
            <span class="counter-item">SO <span id="soCount">0</span></span>
            <span class="counter-item">AO <span id="aoCount">0</span></span>
            <span class="counter-item">BO <span id="boCount">0</span></span>
            <span class="counter-item">CO <span id="coCount">0</span></span>
            <span class="counter-item">DO <span id="doCount">0</span></span>
            <span class="counter-item">EO <span id="eoCount">0</span></span>
            <span class="counter-item total">í•©ê³„ <span id="totalCount">0</span></span>
        </div>

        <div class="box-type-section">
            <label class="input-label">ë°•ìŠ¤íƒ€ì…</label>
            <div class="box-type-container">
                <select class="box-type-select" id="boxType">
                    <option value="S">S</option>
                    <option value="A">A</option>
                    <option value="B">B</option>
                    <option value="C">C</option>
                    <option value="D">D</option>
                    <option value="E">E</option>
                </select>
                <div class="box-buttons">
                    <button class="box-button">ë³€ê²½</button>
                    <button class="box-button">ì‚­ì œ</button>
                </div>
            </div>
            <div class="duplicate-info">
                <span>âœ“</span>
                <span>ì¤‘ë³µ(<span id="duplicateCount">0</span>)</span>
            </div>
        </div>

        <div class="list-header">
            <div></div>
            <div>ìš´ì†¡ì¥ ë²ˆí˜¸</div>
            <div>ì„ íƒ</div>
            <div>ì‚­ì œ</div>
        </div>

        <div id="waybillList"></div>

        <button class="reset-button" id="resetButton">ë¦¬ì…‹</button>

        <div class="log-section">
            <div class="log-title">í‚¤ë³´ë“œ ì´ë²¤íŠ¸ ë¡œê·¸</div>
            <div id="logContainer"></div>
        </div>
    </div>

    <script>
        let waybillList = [];
        let tabCount = 0;
        let shiftTabCount = 0;
        let lastKeyTime = 0;
        const KEY_THRESHOLD = 100; // 100ms ì´ë‚´ ì—°ì† í‚¤ ì…ë ¥

        const waybillInput = document.getElementById('waybillInput');
        const enterButton = document.getElementById('enterButton');
        const resetButton = document.getElementById('resetButton');
        const waybillListContainer = document.getElementById('waybillList');
        const logContainer = document.getElementById('logContainer');

        // ë¡œê·¸ ì¶”ê°€ í•¨ìˆ˜
        function addLog(message, type = 'info') {
            const logEntry = document.createElement('div');
            logEntry.className = `log-entry ${type}`;
            const timestamp = new Date().toLocaleTimeString();
            logEntry.textContent = `[${timestamp}] ${message}`;
            logContainer.insertBefore(logEntry, logContainer.firstChild);
            
            // ë¡œê·¸ê°€ ë„ˆë¬´ ë§ìœ¼ë©´ ì˜¤ë˜ëœ ê²ƒ ì‚­ì œ
            if (logContainer.children.length > 50) {
                logContainer.removeChild(logContainer.lastChild);
            }
        }

        // ì¹´ìš´í„° ì—…ë°ì´íŠ¸
        function updateCounters() {
            const counts = { SO: 0, AO: 0, BO: 0, CO: 0, DO: 0, EO: 0 };
            
            waybillList.forEach(waybill => {
                const firstChar = waybill.charAt(0).toUpperCase();
                if (counts.hasOwnProperty(firstChar + 'O')) {
                    counts[firstChar + 'O']++;
                } else {
                    counts.SO++;
                }
            });

            document.getElementById('soCount').textContent = counts.SO;
            document.getElementById('aoCount').textContent = counts.AO;
            document.getElementById('boCount').textContent = counts.BO;
            document.getElementById('coCount').textContent = counts.CO;
            document.getElementById('doCount').textContent = counts.DO;
            document.getElementById('eoCount').textContent = counts.EO;
            document.getElementById('totalCount').textContent = waybillList.length;
        }

        // ë¦¬ìŠ¤íŠ¸ ë Œë”ë§
        function renderList() {
            if (waybillList.length === 0) {
                waybillListContainer.innerHTML = '<div class="empty-message">ì§‘í•˜ ëŒ€ìƒ í™”ë¬¼ì´ ë“±ë¡ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.</div>';
                return;
            }

            waybillListContainer.innerHTML = waybillList.map((waybill, index) => `
                <div class="list-item">
                    <input type="checkbox" class="checkbox">
                    <div class="waybill-number">${waybill}</div>
                    <button class="select-button" onclick="selectItem(${index})">ì„ íƒ</button>
                    <button class="delete-button" onclick="deleteItem(${index})">ì‚­ì œ</button>
                </div>
            `).join('');
        }

        // í•­ëª© ì„ íƒ
        function selectItem(index) {
            addLog(`í•­ëª© ì„ íƒ: ${waybillList[index]}`, 'info');
        }

        // í•­ëª© ì‚­ì œ
        function deleteItem(index) {
            const waybill = waybillList[index];
            waybillList.splice(index, 1);
            renderList();
            updateCounters();
            addLog(`í•­ëª© ì‚­ì œ: ${waybill}`, 'error');
        }

        // ë¦¬ì…‹ ë²„íŠ¼
        resetButton.addEventListener('click', () => {
            waybillList = [];
            renderList();
            updateCounters();
            waybillInput.value = '';
            waybillInput.focus();
            tabCount = 0;
            shiftTabCount = 0;
            addLog('ë¦¬ìŠ¤íŠ¸ ë¦¬ì…‹ ì™„ë£Œ', 'info');
        });

        // ì…ë ¥ ë²„íŠ¼ í´ë¦­
        enterButton.addEventListener('click', () => {
            addWaybill();
        });

        // Enter í‚¤ë¡œ ì…ë ¥
        waybillInput.addEventListener('keydown', (e) => {
            const currentTime = Date.now();
            const timeSinceLastKey = currentTime - lastKeyTime;
            lastKeyTime = currentTime;

            if (e.key === 'Tab' && !e.shiftKey) {
                // Tab í‚¤
                tabCount++;
                addLog(`Tab í‚¤ ì…ë ¥ (${tabCount}ë²ˆì§¸)`, 'info');
                
                // Tab 2ë²ˆ í›„ ìë™ìœ¼ë¡œ Enter ë²„íŠ¼ í´ë¦­
                if (tabCount === 2) {
                    setTimeout(() => {
                        addLog('Tab 2ë²ˆ í›„ Enter ë²„íŠ¼ í´ë¦­', 'success');
                        enterButton.click();
                        tabCount = 0;
                    }, 50);
                }
                e.preventDefault();
            } else if (e.key === 'Tab' && e.shiftKey) {
                // Shift + Tab í‚¤
                shiftTabCount++;
                addLog(`Shift+Tab í‚¤ ì…ë ¥ (${shiftTabCount}ë²ˆì§¸)`, 'info');
                
                // Shift+Tab 2ë²ˆ í›„ ì…ë ¥ í•„ë“œë¡œ í¬ì»¤ìŠ¤ ë³µê·€
                if (shiftTabCount === 2) {
                    setTimeout(() => {
                        waybillInput.focus();
                        waybillInput.select();
                        addLog('Shift+Tab 2ë²ˆ í›„ ì…ë ¥ í•„ë“œë¡œ í¬ì»¤ìŠ¤ ë³µê·€', 'success');
                        shiftTabCount = 0;
                    }, 50);
                }
                e.preventDefault();
            } else if (e.key === 'Enter') {
                // Enter í‚¤
                addLog('Enter í‚¤ ì…ë ¥', 'info');
                addWaybill();
                e.preventDefault();
            }
        });

        // ì†¡ì¥ë²ˆí˜¸ ì¶”ê°€ í•¨ìˆ˜
        function addWaybill() {
            const waybill = waybillInput.value.trim();
            
            if (!waybill) {
                addLog('ì†¡ì¥ë²ˆí˜¸ê°€ ë¹„ì–´ìˆìŠµë‹ˆë‹¤.', 'error');
                return;
            }

            if (waybillList.includes(waybill)) {
                addLog(`ì¤‘ë³µëœ ì†¡ì¥ë²ˆí˜¸: ${waybill}`, 'error');
                document.getElementById('duplicateCount').textContent = 
                    parseInt(document.getElementById('duplicateCount').textContent) + 1;
                return;
            }

            waybillList.push(waybill);
            renderList();
            updateCounters();
            addLog(`ì†¡ì¥ë²ˆí˜¸ ì¶”ê°€: ${waybill}`, 'success');
            
            // ì…ë ¥ í•„ë“œ ì´ˆê¸°í™” ë° í¬ì»¤ìŠ¤
            waybillInput.value = '';
            waybillInput.focus();
            
            // ì¹´ìš´í„° ì´ˆê¸°í™” (ë‹¤ìŒ ì…ë ¥ì„ ìœ„í•´)
            tabCount = 0;
            shiftTabCount = 0;
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì…ë ¥ í•„ë“œì— í¬ì»¤ìŠ¤
        window.addEventListener('load', () => {
            waybillInput.focus();
            addLog('í…ŒìŠ¤íŠ¸ í˜ì´ì§€ ë¡œë“œ ì™„ë£Œ', 'success');
            addLog('ESP32 í‚¤ ì‹œí€€ìŠ¤ í…ŒìŠ¤íŠ¸: Tab 2ë²ˆ -> Enter -> Shift+Tab 2ë²ˆ', 'info');
        });

        // ì…ë ¥ í•„ë“œ í´ë¦­ ì‹œ ë¡œê·¸
        waybillInput.addEventListener('focus', () => {
            addLog('ì…ë ¥ í•„ë“œ í¬ì»¤ìŠ¤', 'info');
        });

        // Enter ë²„íŠ¼ í¬ì»¤ìŠ¤ ì¶”ì 
        enterButton.addEventListener('focus', () => {
            addLog('ì…ë ¥ ë²„íŠ¼ í¬ì»¤ìŠ¤', 'info');
        });
    </script>
</body>
</html>






